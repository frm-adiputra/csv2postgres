// Code generated by {{.Generator}} DO NOT EDIT

// +build mage

package main

import (
    "fmt"

    "github.com/magefile/mage/mg"
    {{- range .Specs}}
    "{{.ImportPath}}"
    {{- end}}
)

var (
    {{- range .Specs}}
    {{.PkgVar}}DB {{.PkgVar}}.DBSynchronizer
    {{- end}}
)

func init() {
    {{- range .Specs}}
    {{.PkgVar}}DB = {{.PkgVar}}.NewDBSynchronizer()
    {{- end}}
}
{{range .Specs}}
type {{upperCaseFirst .Name}} mg.Namespace
{{- end}}
{{range .Specs}}
// Drop drops table {{.Name}}
func (t {{upperCaseFirst .Name}}) Drop() error {
    db, err := newDBConn()
    if err != nil {
        return err
    }
    defer db.Close()

    fmt.Print("{{upperCaseFirst .Name}}: Dropping table...")
    err = {{.PkgVar}}DB.Drop(db)
    if err != nil {
        fmt.Println("[FAILED]")
        return err
    }
    fmt.Println("[OK]")
    return nil
}

// Create creates table {{.Name}}
func (t {{upperCaseFirst .Name}}) Create() error {
    db, err := newDBConn()
    if err != nil {
        return err
    }
    defer db.Close()

    fmt.Print("{{upperCaseFirst .Name}}: Creating table...")
    err = {{.PkgVar}}DB.Create(db)
    if err != nil {
        fmt.Println("[FAILED]")
        return err
    }
    fmt.Println("[OK]")
    return nil
}

// Delete deletes rows from table {{.Name}}
func (t {{upperCaseFirst .Name}}) Delete() error {
    db, err := newDBConn()
    if err != nil {
        return err
    }
    defer db.Close()

    fmt.Print("{{upperCaseFirst .Name}}: Deleting table...")
    err = {{.PkgVar}}DB.Delete(db)
    if err != nil {
        fmt.Println("[FAILED]")
        return err
    }
    fmt.Println("[OK]")
    return nil
}

// Fill fill rows of table {{.Name}}
func (t {{upperCaseFirst .Name}}) Fill() error {
    db, err := newDBConn()
    if err != nil {
        return err
    }
    defer db.Close()

    fmt.Print("{{upperCaseFirst .Name}}: Filling table...")
    err = {{.PkgVar}}DB.Fill(db)
    if err != nil {
        fmt.Println("[FAILED]")
        return err
    }
    fmt.Println("[OK]")
    return nil
}

// Up recreates and fill rows of table {{.Name}}
func (t {{upperCaseFirst .Name}}) Up() error {
    mg.SerialDeps(
        {{upperCaseFirst .Name}}.Drop,
        {{upperCaseFirst .Name}}.Create,
        {{upperCaseFirst .Name}}.Fill,
    )
    return nil
}
{{end -}}
